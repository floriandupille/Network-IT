Pr√©-requis semaine Administration Linux Avanc√©e / Firewall
Pas besoin du mat√©riel r√©seau de la derni√®re semaine, seulement sur vos PC pour le moment avec le r√©seau WiFi du b√¢timent.
Commencer √† r√©aliser les op√©rations suivantes d√®s 9h00 :
Cr√©er une VM Ubuntu Server 22.04 sur votre PC
2 CPU, 2Go de RAM, 30Go HDD
NIC Bridge ou NAT le temps d'installer l'OS
ISO https://releases.ubuntu.com/22.04.3/ubuntu-22.04.3-live-server-amd64.iso

Utilisateur : toor
Mot de passe de l'utilisateur toor : toor

Tester la connexion en SSH avec l'utilisateur toor depuis le CMD de votre PC

Clone de la VM: une fois l'OS de la VM install√©e et update ‚Üí r√©aliser un clone de la VM √©teinte.

Vous pouvez ensuite vous documenter sur le fonctionnement du service SSH et du service FTP sur Linux
SSH service: https://doc.ubuntu-fr.org/ssh

FTP service: https://doc.ubuntu-fr.org/vsftpd 
Prerequisites week Advanced Linux Administration / Firewall
No need for last week's network hardware, only on your PCs for the moment with the building's WiFi network.
Start carrying out the following operations from 9:00 a.m.:
Create an Ubuntu Server 22.04 VM on your PC
2 CPU, 2GB RAM, 30GB HDD
NIC Bridge or NAT while installing the OS
ISO https://releases.ubuntu.com/22.04.3/ubuntu-22.04.3-live-server-amd64.iso

User: toor
Password of user toor: toor

Test the SSH connection with the toor user from your PC's CMD

Clone the VM: once the VM OS is installed and updated ‚Üí create a clone of the powered-off VM.

You can then read up on how the SSH service and FTP service work on Linux
SSH service: https://doc.ubuntu-fr.org/ssh

FTP service: https://doc.ubuntu-fr.org/vsftpd 
rbrusse ‚Äî Hier √† 09:32
https://gist.github.com/NSWG/2ad67111efb983c762e3425ff49ba2ad
Gist
VMware Workstation 16 Pro and Player keys
VMware Workstation 16 Pro and Player keys. GitHub Gist: instantly share code, notes, and snippets.
VMware Workstation 16 Pro and Player keys
rbrusse ‚Äî Hier √† 10:15
LAB - Mise en pr√©-prod d'un serveur Linux Ubuntu 22.04
ETAPE 1 > Configurer une @IP static sur Ubuntu:
Rep√©rer la d√©nomination de votre NIC (Network Interface Card) avec la commande  ‚ö†Ô∏è
ip a

La d√©nomination des interfaces r√©seaux Linux ressemble √† ceci: 
https://www.linuxtricks.fr/wiki/nomenclature-des-interfaces-reseau-sous-linux-enp0s3-wlo1

Modifier le fichier de configuration "YAML" dans /etc/netplan/ pour assigner une @IP static √† la VM
Vous √™tes sur Ubuntu, utilisez la commande sudo -i pour passer root

netplan generate

nano /etc/netplan/00-installer-config.yaml

 # This is the network config written by 'subiquity'
network:
  ethernets:
    ensXXX:
      addresses: [192.168.1.150/24]
      routes:
       - to: 0.0.0.0/0
         via: 192.168.1.1
         metric: 3
      nameservers:
        addresses: [8.8.8.8, 8.8.4.4]
      dhcp4: false
      dhcp6: false
  version: 2


netplan apply

Pour d√©bug:
netplan --debug apply

Etape 1.1 > V√©rifier les modifications r√©seau et r√©aliser des tests de connectivit√©s
ip a pour v√©rifier toujours, et ip route

ping votre_paserelle

ping google.com

ETAPE 2.1 > Changer le nom d'h√¥te d'une VM Ubuntu
hostnamectl hostname lenomdevotrechoix

Lancer la commande hostnamectl pour observer la modification
V√©rifier si le nom de l'h√¥te correspond dans le fichier de configuration suivant:
hostnamectl

nano /etc/hostname
nano /etc/hosts

ETAPE 3 > Editer le fichier de source des paquets > sources.list suivant votre version:
V√©rifier la pr√©sence des sources des paquets >
nano /etc/apt/sources.list

Mettre √† jour les sources des paquers APT
 apt-get update

Tester si vous pouvez rechercher netstat et l'installer
apt search netstat

apt-get install net-tools

netstat -laputen


___ 
ETAPE 5 > Configurer l'heure de la VM en fonction de la TimeZone Europe/Paris
sudo timedatectl set-timezone Europe/Paris

Afficher la nouvelle configuration
timedatectl

__ 
R√©seau sans-fil salle MPT TSSR:
SSID: SimplonInfra
PSK: MerciSimplon

__ 
rbrusse ‚Äî Hier √† 11:20
Follow me on Zoom
https://us02web.zoom.us/j/2108423844?pwd=SGRQQy9Bb0JLeElTZVh0cHJIRXpPZz09
Zoom Video
Join our Cloud HD Video Meeting
Zoom is the leader in modern enterprise video communications, with an easy, reliable cloud platform for video and audio conferencing, chat, and webinars across mobile, desktop, and room systems. Zoom Rooms is the original software-based conference room solution used around the world in board, conference, huddle, and training rooms, as well as ex...
rbrusse ‚Äî Hier √† 13:49
LAB - Allow SSH Users
Trouver une solution pour n'autoriser que certains utilisateurs √† se connecter en SSH.
Disons titi et tata cette fois, mais pas toto.

Pour tester, depuis votre PC avec PowerShell
ssh titi@192.168.X.X

Correction - interdire des utilisateurs sur SSH

Trouver une solution pour n'autoriser que certains utilisateurs √† se connecter en SSH. Disons titi et tata cette fois, mais pas toto.

Cr√©er un groupe qui permettra aux utilisateurs membre d'acc√©der au serveur en SSH. 

addgroup authorized_ssh_group

Ajouter les utilisateurs que l'on souhaite qui disposeront de permissions √† SSH 

usermod -a -G authorized_ssh_group titi
usermod -a -G authorized_ssh_group tata

Editer le fichier de configuration du service SSH: 
nano /etc/ssh/sshd_config

Ajouter la ligne suivante:
 AllowGroups authorized_ssh_group

Red√©marrer le service SSH: 
systemctl restart ssh

Tester depuis le PC avec PowerShell 
ssh titi@192.168.X.X

Note: On pourrait √† l'inverse de l'option Allow utiliser l'option Deny:

DenyUsers les_users

Ou encore 

DenyGroups forbiden_ssh_group

__ 
rbrusse ‚Äî Hier √† 14:14
LAB - Sudoers
Faites en sorte que l'utilisateur titi puisse avoir des droits sudoers, par exemple qu'il puisse red√©marrer des services...

usermod -a -G sudo titi


https://www.digitalocean.com/community/tutorials/how-to-edit-the-sudoers-file-fr
___ 
Comment modifier le fichier Sudoers  | DigitalOcean
Sudo est une commande pratique qui vous permet d‚Äôex√©cuter des commandes avec des privil√®ges qui ne sont g√©n√©ralement pas de la port√©e de votre utilisateur. C‚Ä¶
Image
rbrusse ‚Äî Hier √† 14:26
LAB FTP avec VSFTP
https://www.digitalocean.com/community/tutorials/how-to-set-up-vsftpd-for-a-user-s-directory-on-ubuntu-20-04

Correction
Interdire aux utilisateurs de lire le r√©pertoire home des autres utilisateurs
dpkg-reconfigure adduser  > Passer √† NO

Ajout d'un utilisateur
adduser sammy

Install VSFTP
apt-get update 
apt-get install vsftpd

Backup du fichier de config VSFTP par d√©faut
cp /etc/vsftpd.conf /etc/vsftpd.conf.backup

Cr√©ation dossier parent CHROOT
mkdir /home/sammy/ftp
chown nobody:nogroup /home/sammy/ftp/

La commande chmod a-w concerne toutes les cat√©gories d‚Äôutilisateurs.
chmod a-w /home/sammy/ftp

Cr√©ation dossier FTP CHROOT
mkdir /home/sammy/ftp/files
chown sammy:sammy /home/sammy/ftp/files

Cr√©ation fichier test
echo "hello everyone" | tee /home/sammy/ftp/files/test.txt

Param√©trage VSFTP
nano /etc/vsftpd.conf

listen=NO
listen_ipv6=YES
anonymous_enable=NO
local_enable=YES
write_enable=YES
dirmessage_enable=YES
use_localtime=YES
xferlog_enable=YES
connect_from_port_20=YES

chroot_local_user=YES
user_sub_token=$USER
local_root=/home/$USER/ftp
userlist_enable=YES
userlist_file=/etc/vsftpd.userlist
userlist_deny=NO
secure_chroot_dir=/var/run/vsftpd/empty
pam_service_name=vsftpd

Ajout d'utilisateur √† VSFTP
Enfin, ajoutons notre utilisateur √† /etc/vsftpd.userlist. 
Utilisez l'option -a de la commande tee -a pour ajouter au fichier :

echo "sammy" | tee -a /etc/vsftpd.userlist

Red√©marrage du service
systemctl restart vsftpd

D√©bug du service VSFTP
systemctl status vsftpd

tail -f /var/log/syslog

__ 
How To Set Up vsftpd for a User's Directory on Ubuntu 20.04  | Digi...
FTP, which is short for File Transfer Protocol, is a network protocol that was once widely used for moving files between a client and server. vsftpd, very se‚Ä¶
Image
rbrusse ‚Äî Hier √† 16:31
Terminal Windows
https://www.microsoft.com/store/productid/9N0DX20HK701?ocid=pdpshare

PowerShell
https://www.microsoft.com/store/productid/9MZ1SNWT0N5D?ocid=pdpshare 
rbrusse ‚Äî Hier √† 17:06
R√©cap de la journ√©e
SSH Secure Shell - :22
administrer des ressources √† distance (switch - server Linux)
SSH permet de chiffrer les √©changes entre le client et le serveur

SCP Secure Copy Protocol - :22
Copie de fichiers ou dossiers en CLI (commande complexe)
GUI possible avec WinSCP

FTP File Transfert Protocol - :20 et :21
Pour les d√©veloppeurs > serveur web SaaS de type Hostinger, 1and1, OVH, Wordpress h√©berg√©...
Pour le transfert du fichier volumineux
Pour les EDI Echange de Donn√©es Informatiques entre des ERP ou CRM d'une entit√© et son fournisseur

TFP Trivial File Transfert Protocol - :69
TFTP reste tr√®s utilis√© pour la mise √† jour des logiciels embarqu√©s sur les √©quipements r√©seaux (routeurs, pare-feu, etc.) ou pour d√©marrer un PC √† partir d'une carte r√©seau.

__
https://ipcisco.com/lesson/tftp-ftp-sftp-and-scp/ 
Image
Image
rbrusse ‚Äî Hier √† 17:21
Pluggable Authentication Modules (PAM)
Pluggable Authentication Modules (modules d‚Äôauthentification enfichables, en abr√©g√© PAM) est un m√©canisme permettant d‚Äôint√©grer diff√©rents sch√©mas d‚Äôauthentification de bas niveau dans une API de haut niveau, permettant de ce fait de rendre ind√©pendants du sch√©ma les logiciels r√©clamant une authentification.
Image
SSH - Secure Shell
https://www.hostinger.fr/tutoriels/ssh-linux
https://www.it-connect.fr/chapitres/quest-ce-que-ssh/
Hostinger Tutoriels
Qu'est ce que SSH ? Tout ce qu'il Faut Savoir [2023]
Vous voulez en savoir plus sur le fonctionnement du SSH ? Nous vous montrons tout ce qu'il faut savoir dans ce petit tutoriel !
Qu'est ce que SSH ? Tout ce qu'il Faut Savoir [2023]
IT-Connect
Qu'est-ce que SSH ? | IT-Connect
SSH signifie "Secure Shell", il s'agit donc d'un "shell" dit "s√©curis√©"
Image
rbrusse ‚Äî Hier √† 18:24
[Rappel] Permissions Linux - chmod
chmod est la commande qui permet de changer les permissions des fichiers et des dossiers.

Voici sa syntaxe :
chmod [option] permission fichier
o√π les permissions peuvent √™tre not√©es en octal :
chmod 777 fichier

Ou en mode symbolique selon la syntaxe en utilisant :
les cat√©gories d‚Äôutilisateur : u, g, o et a (all)
des op√©rateurs d‚Äôajout/suppression : =, + et -
des droits : r, w et/ou x

chmod u+rwx,g+rwx,o+rwx

https://chmod-calculator.com/

__ 
Image
Image
Image
Image
rbrusse ‚Äî Hier √† 18:45
√ätre un dieu des droits Linux
Pour ceux qui ont envie de comprendre le fonctionnement des utilisateurs, des groupes sous Linux, j'ai moi m√™me appris avec ce site il y a des ann√©es:

https://fr.m.wikibooks.org/wiki/Le_syst√®me_d'exploitation_GNU-Linux/Les_utilisateurs_et_groupes

√âgalement un de mes favoris pour les droits et les permissions sous Linux.

https://www.leshirondellesdunet.com/chmod-et-chown 
Le syst√®me d'exploitation GNU-Linux/Les utilisateurs et groupes
Les Hirondelles du Net
Chmod et Chown, les droits sous GNU/Linux - Les Hirondelles du Net
Un tutoriel simple avec des exemples pratiques sur des fichiers et r√©pertoires sous GNU/Linux.
Image
rbrusse ‚Äî Aujourd‚Äôhui √† 09:05
LAB Bruteforce SSH
Avant de t√©l√©charger un paquet, j'update les sources:
apt-get update

Installation du logiciel Hydra
apt-get install hydra

T√©l√©charger un dictionnaire de mot de passe dans le dossier de l'utilisateur /root
cd /root
pwd
wget https://github.com/brannondorsey/naive-hashcat/releases/download/data/rockyou.txt

Pour voir que le dictionnaire est bien dans le dossier de /root
ls -l
Manuel Hydra
hydra

Commande Hydra permettant de lancer un scan bruteforce en SSH. (attaquer l'un de vos bin√¥mes)
hydra -V -f -t 4 -l toor -P /root/rockyou.txt ssh://192.168.X.X:22

__ 
Image
Par ici:

https://us02web.zoom.us/j/2108423844?pwd=SGRQQy9Bb0JLeElTZVh0cHJIRXpPZz09
Zoom Video
Join our Cloud HD Video Meeting
Zoom is the leader in modern enterprise video communications, with an easy, reliable cloud platform for video and audio conferencing, chat, and webinars across mobile, desktop, and room systems. Zoom Rooms is the original software-based conference room solution used around the world in board, conference, huddle, and training rooms, as well as ex...
rbrusse ‚Äî Aujourd‚Äôhui √† 09:29
Pour observer les logs SSH:
Pour afficher les logs et observer que quelqu'un vous attaque en brute force
apt-get install ccze

tail -f /var/log/auth.log | ccze

__ 
rbrusse ‚Äî Aujourd‚Äôhui √† 10:35
[Updated] Configuration d'une clef SSH pour les serveurs Ubuntu/Debian (GNU/Linux)
Sur la VM Linux, se placer dans le r√©pertoire SSH de l'utilisateur
cd /home/titi/.ssh

Si le r√©pertoire n'existe pas
mkdir /home/titi/.ssh
cd /home/titi/.ssh

G√©n√©rer une clef SSH, garder le path et le nom par d√©faut id_rsa
ssh-keygen

Ensuite, ajoutez la cl√© publique au fichier authorized_keys en saisissant ce qui suit :
cat /home/titi/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys

Appliquer une permissions sur le dossier 700
chmod -R 700 /home/titi/.ssh/ 

Sur votre poste Windows, importer la clef priv√©e avec SCP dans votre dossier utilisateur Windows:
scp titi@10.0.X.X:/home/titi/.ssh/id_rsa "C:\Users\votre_user_windows\.ssh\titikey"

(Adapter IP et Path aux besoins)

Configuration SSH-Server
Une fois la clef priv√© import√© sur votre machine Windows, il va falloir aller modifier le fonctionnement du service SSH sur la VM Linux:
nano /etc/ssh/sshd_config -c

D√©sactiver l'authentification par mot de passe et n'accepter que l'authentification par certificat
Commenter ou D√©-Commenter les lignes suivantes et changer les valeurs:
# Include /etc/ssh/sshd_config.d/*.conf
PermitRootLogin without-password
PasswordAuthentication no
PubkeyAuthentication yes
ChallengeResponseAuthentication no

Red√©marrer le service SSH
systemctl restart ssh

Pour se connecter depuis Windows Terminal:
ssh -i "C:\Users\votre_user_windows\.ssh\titikey" titi@10.0.0.XXX


___ 
Image
rbrusse ‚Äî Aujourd‚Äôhui √† 11:26
New Terminal Windows + New PowerShell 
rbrusse ‚Äî Aujourd‚Äôhui √† 12:40
Comment proc√©der pour conna√Ætre sa distribution Linux
cat /etc/*release

__ 
rbrusse ‚Äî Aujourd‚Äôhui √† 14:05
Solution backup RSYNC  - (√† perfectionner)
https://www.wundertech.net/how-to-backup-a-linux-pc-to-a-synology-nas-using-rsync/

Installer rsync
apt-get install rsync

Commande permettant de copier les donn√©es du Linux √† destination du NAS
Pour sauvegarder avec rsync:
rsync -avx /home/titi/* admin@192.168.XXX.XXX:/volume1/NetBackup/

Pour restaurer avec rsync:
rsync -avx admin@IP_du_NAS :/Volume1/NetBackup/ /home/destination_de_la_restauration/

Pour ceux qui souhaitent perfectionner la solution de backup avec une clef SSH pour l'authentification rsync √† la place du mot de passe üòâ
https://www.wundertech.net/use-ssh-keys-to-automatically-backup-a-linux-pc-to-a-synology-nas/

Pour obliger rsync √† utiliser la clef SSH de l'admin du NAS
rsync -e ssh -ax /chemin/source admin@192.168.X.X:/volume1/NetBackup

__ 
WunderTech
How to Use Rsync on a Synology NAS
In this tutorial, we will look at how to use Rsync on a Synology NAS. https://youtu.be/wSGaG3AQV7o Rsync is a tool that can be used to sync files from one location to another. This tutorial will
How to Use Rsync on a Synology NAS
WunderTech
Use SSH Keys to Automatically Backup a Linux PC to a Synology NAS!
Today we are going to look at how you can use SSH keys and Cron to automatically back up a Linux PC to a Synology NAS. https://youtu.be/kvK3S3Wsx2M The process will allow you to automatically authenticate
Use SSH Keys to Automatically Backup a Linux PC to a Synology NAS!
rbrusse ‚Äî Aujourd‚Äôhui √† 14:42
Upgrade d'une seule application GNU/Linux
sudo apt-get install --only-upgrade openssh-server

__ 
rbrusse ‚Äî Aujourd‚Äôhui √† 15:03
Cr√©er une exception pour permettre √† un user de se connecter avec un  mot de passe
Apr√®s vous √™tre assur√© que tous vos users ne peuvent se connecter que via une cl√© ssh, retournez dans votre fichier sshd_config

sudo nano /etc/ssh/sshd_config -c

Ajoutez en fin de fichier les param√®tres suivants : 

Match User nom_du_user
PasswordAuthentication yes
Match all

Enregistrez puis red√©marrez le ssh : 

systemctl restart ssh

Vous pouvez maintenant tester de vous connecter par mot de passe avec votre compte exclu. 
rbrusse ‚Äî Aujourd‚Äôhui √† 16:06
NAS Info
http://10.0.0.100/

Login: NAS
Pwd: Junki123
rbrusse ‚Äî Aujourd‚Äôhui √† 16:27
RSYNC
rsync (pour remote synchronization ou synchronisation √† distance), est un logiciel de synchronisation de fichiers. Il est fr√©quemment utilis√© pour mettre en place des syst√®mes de sauvegarde distante ou des points de restauration du syst√®me.

rsync travaille de mani√®re unidirectionnelle c'est-√†-dire qu'il synchronise, copie ou actualise les donn√©es d'une source (locale ou distante) vers une destination (locale ou distante) en ne transf√©rant que les octets des fichiers qui ont √©t√© modifi√©s.

https://www.hostinger.fr/tutoriels/commande-rsync-linux

__ 
Image
rbrusse ‚Äî Aujourd‚Äôhui √† 18:33
Cr√©er un banni√®re d'avertissement SSH
Les avertissements de banni√®re SSH sont n√©cessaires lorsque les entreprises ou les organisations souhaitent afficher un avertissement s√©v√®re pour d√©courager les parties non autoris√©es d'acc√©der √† un serveur.

Ces avertissements sont affich√©s juste avant l'invite du mot de passe afin que les utilisateurs non autoris√©s qui sont sur le point de se connecter soient inform√©s des cons√©quences d'une telle connexion. En r√®gle g√©n√©rale, ces avertissements constituent des cons√©quences juridiques que les utilisateurs non autoris√©s peuvent subir s'ils d√©cident de proc√©der √† l'acc√®s au serveur.

Ajouter dans le fichier le config du serveur SSH la ligne suivante
Banner /etc/ssh/banniere_ssh

Cr√©er un fichier texte de banni√®re SSH avec des avertissements
nano /etc/ssh/banniere_ssh

L
    __ __    ______    ______    ____           ____    __  __  ______
   / //_/   / ____/   / ____/   / __ \         / __ \  / / / / /_  __/
  / ,<     / __/     / __/     / /_/ /        / / / / / / / /   / /   
 / /| |   / /___    / /___    / ____/        / /_/ / / /_/ /   / /    
/_/ |_|  /_____/   /_____/   /_/             \____/  \____/   /_/     
                                                                                                                             


Vous pouvez g√©n√©rer une banni√®re en ASCII avec ce site
https://manytools.org/hacker-tools/ascii-banner/

Red√©marrer le service SSH et connectez-vous en SSH pour observer votre ≈ìuvre !
__ 
Image
Manytools.org - Your online toolshed
Create ASCII text banners online
Image
